#include <stdio.h>
#include <stdlib.h>
#include <math.h>

int cnt = 0;

#if 1

static const float f_sintbl[] = {
  0.00000000000000000000e+00, 6.13588464915447526909e-03,
  1.22715382857199253874e-02, 1.84067299058048201854e-02,
  2.45412285229122881236e-02, 3.06748031766366259510e-02,
  3.68072229413588317137e-02, 4.29382569349408202419e-02,
  4.90676743274180149346e-02, 5.51952443496899342046e-02,
  6.13207363022085782944e-02, 6.74439195636640509424e-02,
  7.35645635996674263080e-02, 7.96824379714301256339e-02,
  8.57973123444398938497e-02, 9.19089564971327238618e-02,
  9.80171403295606036288e-02, 1.04121633872054586423e-01,
  1.10222207293883059376e-01, 1.16318630911904752345e-01,
  1.22410675199216195663e-01, 1.28498110793793168805e-01,
  1.34580708507126167728e-01, 1.40658239332849210879e-01,
  1.46730474455361747932e-01, 1.52797185258443435352e-01,
  1.58858143333861445701e-01, 1.64913120489969922122e-01,
  1.70961888760301217172e-01, 1.77004220412148749464e-01,
  1.83039887955140950782e-01, 1.89068664149806192620e-01,
  1.95090322016128248084e-01, 2.01104634842091900548e-01,
  2.07111376192218560321e-01, 2.13110319916091361936e-01,
  2.19101240156869797593e-01, 2.25083911359792832041e-01,
  2.31058108280671109513e-01, 2.37023605994367198013e-01,
  2.42980179903263870944e-01, 2.48927605745720148533e-01,
  2.54865659604514571690e-01, 2.60794117915275514008e-01,
  2.66712757474898365384e-01, 2.72621355449948976624e-01,
  2.78519689385053059727e-01, 2.84407537211271876920e-01,
  2.90284677254462331053e-01, 2.96150888243623788831e-01,
  3.02005949319228084171e-01, 3.07849640041534866608e-01,
  3.13681740398891517607e-01, 3.19502030816015691883e-01,
  3.25310292162262926219e-01, 3.31106305759876429207e-01,
  3.36889853392220051109e-01, 3.42660717311994378331e-01,
  3.48418680249434564722e-01, 3.54163525420490343798e-01,
  3.59895036534988110866e-01, 3.65612997804773853794e-01,
  3.71317193951837543064e-01, 3.77007410216418259452e-01,
  3.82683432365089781779e-01, 3.88345046698826246168e-01,
  3.93992040061048098831e-01, 3.99624199845646788098e-01,
  4.05241314004989860997e-01, 4.10843171057903910892e-01,
  4.16429560097637152527e-01, 4.22000270799799681587e-01,
  4.27555093430282084910e-01, 4.33093818853151957260e-01,
  4.38616238538527658530e-01, 4.44122144570429200350e-01,
  4.49611329654606539652e-01, 4.55083587126343835916e-01,
  4.60538710958240005144e-01, 4.65976495767966181205e-01,
  4.71396736825997642040e-01, 4.76799230063322088125e-01,
  4.82183772079122718868e-01, 4.87550160148435995922e-01,
  4.92898192229784037899e-01, 4.98227666972781868537e-01,
  5.03538383725717575423e-01, 5.08830142543106989095e-01,
  5.14102744193221661284e-01, 5.19355990165589642693e-01,
  5.24589682678468949284e-01, 5.29803624686294605262e-01,
  5.34997619887097153324e-01, 5.40171472729892854225e-01,
  5.45324988422046463832e-01, 5.50457972936604811309e-01,
  5.55570233019602177649e-01, 5.60661576197336031235e-01,
  5.65731810783613120464e-01, 5.70780745886967255665e-01,
  5.75808191417845338655e-01, 5.80813958095764526490e-01,
  5.85797857456438864077e-01, 5.90759701858874164415e-01,
  5.95699304492433356906e-01, 6.00616479383868973052e-01,
  6.05511041404325545123e-01, 6.10382806276309475280e-01,
  6.15231590580626819253e-01, 6.20057211763289095607e-01,
  6.24859488142386343412e-01, 6.29638238914926984258e-01,
  6.34393284163645487794e-01, 6.39124444863775731385e-01,
  6.43831542889791386131e-01, 6.48514401022112441098e-01,
  6.53172842953776755515e-01, 6.57806693297078637350e-01,
  6.62415777590171783729e-01, 6.66999922303637471366e-01,
  6.71558954847018330092e-01, 6.76092703575315923104e-01,
  6.80600997795453022121e-01, 6.85083667772700355414e-01,
  6.89540544737066829484e-01, 6.93971460889654001569e-01,
  6.98376249408972915589e-01, 7.02754744457225299925e-01,
  7.07106781186547461715e-01, 7.11432195745216433558e-01,
  7.15730825283818594684e-01, 7.20002507961381654766e-01,
  7.24247082951466891743e-01, 7.28464390448225196373e-01,
  7.32654271672412815697e-01, 7.36816568877369793000e-01,
  7.40951125354959105884e-01, 7.45057785441465947329e-01,
  7.49136394523459259176e-01, 7.53186799043612409399e-01,
  7.57208846506484456462e-01, 7.61202385484261778714e-01,
  7.65167265622458958596e-01, 7.69103337645579587800e-01,
  7.73010453362736993377e-01, 7.76888465673232442299e-01,
  7.80737228572094377199e-01, 7.84556597155575241587e-01,
  7.88346427626606227612e-01, 7.92106577300212388870e-01,
  7.95836904608883455303e-01, 7.99537269107905013144e-01,
  8.03207531480644831845e-01, 8.06847553543799222986e-01,
  8.10457198252594768206e-01, 8.14036329705948302760e-01,
  8.17584813151583711388e-01, 8.21102514991104648345e-01,
  8.24589302785025290987e-01, 8.28045045257755796264e-01,
  8.31469612302545235671e-01, 8.34862874986380010256e-01,
  8.38224705554837967725e-01, 8.41554977436898332677e-01,
  8.44853565249707005869e-01, 8.48120344803297121494e-01,
  8.51355193105265195541e-01, 8.54557988365400533759e-01,
  8.57728610000272118086e-01, 8.60866938637767309395e-01,
  8.63972856121586696432e-01, 8.67046245515692648453e-01,
  8.70086991108711349519e-01, 8.73094978418290090794e-01,
  8.76070094195406601223e-01, 8.79012226428633414166e-01,
  8.81921264348354938534e-01, 8.84797098430937789537e-01,
  8.87639620402853934955e-01, 8.90448723244757878170e-01,
  8.93224301195515324459e-01, 8.95966249756185106889e-01,
  8.98674465693953816725e-01, 9.01348847046022028096e-01,
  9.03989293123443338196e-01, 9.06595704514915334826e-01,
  9.09167983090522269229e-01, 9.11706032005429878318e-01,
  9.14209755703530690951e-01, 9.16679059921042704850e-01,
  9.19113851690057770405e-01, 9.21514039342041901826e-01,
  9.23879532511286738483e-01, 9.26210242138311268256e-01,
  9.28506080473215478222e-01, 9.30766961078983712241e-01,
  9.32992798834738845670e-01, 9.35183509938947499229e-01,
  9.37339011912574959773e-01, 9.39459223602189918978e-01,
  9.41544065183020806309e-01, 9.43593458161960385588e-01,
  9.45607325380521279712e-01, 9.47585591017741091235e-01,
  9.49528180593036674750e-01, 9.51435020969008338199e-01,
  9.53306040354193751085e-01, 9.55141168305770671410e-01,
  9.56940335732208935404e-01, 9.58703474895871599060e-01,
  9.60430519415565786545e-01, 9.62121404269041580193e-01,
  9.63776065795439840223e-01, 9.65394441697689398296e-01,
  9.66976471044852070591e-01, 9.68522094274417266746e-01,
  9.70031253194543974239e-01, 9.71503890986251783524e-01,
  9.72939952205560065757e-01, 9.74339382785575858215e-01,
  9.75702130038528570033e-01, 9.77028142657754394840e-01,
  9.78317370719627654729e-01, 9.79569765685440518865e-01,
  9.80785280403230430579e-01, 9.81963869109555242964e-01,
  9.83105487431216285010e-01, 9.84210092386929025210e-01,
  9.85277642388941221618e-01, 9.86308097244598669384e-01,
  9.87301418157858434732e-01, 9.88257567730749464374e-01,
  9.89176509964781014439e-01, 9.90058210262297122561e-01,
  9.90902635427780009714e-01, 9.91709753669099525197e-01,
  9.92479534598709967064e-01, 9.93211949234794500008e-01,
  9.93906970002356060512e-01, 9.94564570734255415374e-01,
  9.95184726672196817709e-01, 9.95767414467659817134e-01,
  9.96312612182778001291e-01, 9.96820299291165667910e-01,
  9.97290456678690206971e-01, 9.97723066644191636243e-01,
  9.98118112900149179190e-01, 9.98475580573294774211e-01,
  9.98795456205172405006e-01, 9.99077727752645361470e-01,
  9.99322384588349543755e-01, 9.99529417501093142562e-01,
  9.99698818696204249967e-01, 9.99830581795823403191e-01,
  9.99924701839144502991e-01, 9.99981175282601109089e-01,
};

#define SINTABLE_SIZE (sizeof(f_sintbl)/sizeof(f_sintbl[0]))
#define SINTABLE_DELTA ((M_PI / 2.) / (SINTABLE_SIZE))
#define SINTABLE_REVDELTA ((SINTABLE_SIZE) / (M_PI / 2.))

#else
static const float f_sintbl[] = {
  0.00000000000000000000e+00, 6.15994663813864730406e-03,
  1.23196595352384422745e-02, 1.84789049591299048281e-02,
  2.46374491953819697854e-02, 3.07950585561703529813e-02,
  3.69514993891448886854e-02, 4.31065380862955746522e-02,
  4.92599410928168529589e-02, 5.54114749159699479519e-02,
  6.15609061339428345616e-02, 6.77080014047074518757e-02,
  7.38525274748739607444e-02, 7.99942511885416290829e-02,
  8.61329394961460048652e-02, 9.22683594633019882325e-02,
  9.84002782796427055700e-02, 1.04528463267653456970e-01,
  1.10652681891500834221e-01, 1.16772701765856301570e-01,
  1.22888290664714114331e-01, 1.28999216530203270059e-01,
  1.35105247481392964914e-01, 1.41206151823091374808e-01,
  1.47301698054637497659e-01, 1.53391654878685362862e-01,
  1.59475791209980788388e-01, 1.65553876184129949989e-01,
  1.71625679166359623729e-01, 1.77690969760268602240e-01,
  1.83749517816570340223e-01, 1.89801093441825746710e-01,
  1.95845467007166956774e-01, 2.01882409157010250800e-01,
  2.07911690817759314820e-01, 2.13933083206497426376e-01,
  2.19946357839668593659e-01, 2.25951286541747647929e-01,
  2.31947641453898151243e-01, 2.37935195042618757855e-01,
  2.43913720108377141127e-01, 2.49882989794230819802e-01,
  2.55842777594435577537e-01, 2.61792857363040254448e-01,
  2.67733003322467910667e-01, 2.73662990072082834558e-01,
  2.79582592596743784163e-01, 2.85491586275342046353e-01,
  2.91389746889324618984e-01, 2.97276850631202627095e-01,
  3.03152674113043529847e-01, 3.09016994374947395752e-01,
  3.14869588893507856842e-01, 3.20710235590255132720e-01,
  3.26538712840083289457e-01, 3.32354799479659623884e-01,
  3.38158274815817116998e-01, 3.43948918633928124589e-01,
  3.49726511206261136966e-01, 3.55490833300317998766e-01,
  3.61241666187152921097e-01, 3.66978791649672064779e-01,
  3.72701991990913972241e-01, 3.78411050042310292962e-01,
  3.84105749171925858754e-01, 3.89785873292679330149e-01,
  3.95451206870542526506e-01, 4.01101534932718772897e-01,
  4.06736643075800152758e-01, 4.12356317473903499771e-01,
  4.17960344886783408125e-01, 4.23548512667924259567e-01,
  4.29120608772608935766e-01, 4.34676421765964937638e-01,
  4.40215740830987301013e-01, 4.45738355776538197617e-01,
  4.51244057045322832789e-01, 4.56732635721840585230e-01,
  4.62203883540313165135e-01, 4.67657592892586793099e-01,
  4.73093556836010065147e-01, 4.78511569101286504679e-01,
  4.83911424100301579276e-01, 4.89292916933923571765e-01,
  4.94655843399778805125e-01, 4.99999999999999944489e-01,
  5.05325183948947986856e-01, 5.10631193180906994833e-01,
  5.15917826357751074795e-01, 5.21184882876585042766e-01,
  5.26432162877355724895e-01, 5.31659467250436001962e-01,
  5.36866597644179988080e-01, 5.42053356472449343606e-01,
  5.47219546922111166332e-01, 5.52364972960505795641e-01,
  5.57489439342885528816e-01, 5.62592751619823028264e-01,
  5.67674716144590085776e-01, 5.72735140080505189530e-01,
  5.77773831408251115072e-01, 5.82790598933160874928e-01,
  5.87785252292473137103e-01, 5.92757601962554891983e-01,
  5.97707459266093588113e-01, 6.02634636379256294347e-01,
  6.07538946338816887582e-01, 6.12420203049250044813e-01,
  6.17278221289792927706e-01, 6.22112816721473893544e-01,
  6.26923805894106456194e-01, 6.31711006253250939579e-01,
  6.36474236147141381181e-01, 6.41213314833578351681e-01,
  6.45928062486787357699e-01, 6.50618300204242050455e-01,
  6.55283850013453572636e-01, 6.59924534878722601761e-01,
  6.64540178707857975837e-01, 6.69130606358858237570e-01,
  6.73695643646557207340e-01, 6.78235117349233918027e-01,
  6.82748855215185468381e-01, 6.87236685969262683926e-01,
  6.91698439319369917655e-01, 6.96133945962926659057e-01,
  7.00543037593290951470e-01, 7.04925546906147171278e-01,
  7.09281307605853394982e-01, 7.13610154411752239945e-01,
  7.17911923064441848119e-01, 7.22186450332009233222e-01,
  7.26433574016224103964e-01, 7.30653132958693163346e-01,
  7.34844967046975661162e-01, 7.39008917220659089509e-01,
  7.43144825477394133095e-01, 7.47252534878890872783e-01,
  7.51331889556873244729e-01, 7.55382734718993753553e-01,
  7.59404916654707107249e-01, 7.63398282741102884863e-01,
  7.67362681448696903885e-01, 7.71297962347180621201e-01,
  7.75203976111129788862e-01, 7.79080574525670477293e-01,
  7.82927610492102799000e-01, 7.86744938033483220963e-01,
  7.90532412300163245256e-01, 7.94289889575286012224e-01,
  7.98017227280239493936e-01, 8.01714283980066722002e-01,
  8.05380919388832605676e-01, 8.09016994374947451263e-01,
  8.12622370966445628504e-01, 8.16196912356221604412e-01,
  8.19740482907221013065e-01, 8.23252948157587205458e-01,
  8.26734174825763501460e-01, 8.30184030815550588756e-01,
  8.33602385221119401848e-01, 8.36989108331977815780e-01,
  8.40344071637892708893e-01, 8.43667147833766395415e-01,
  8.46958210824467094824e-01, 8.50217135729614104100e-01,
  8.53443798888315896534e-01, 8.56638077863862701378e-01,
  8.59799851448372343121e-01, 8.62928999667389673434e-01,
  8.66025403784438596588e-01, 8.69088946305528242675e-01,
  8.72119510983610735089e-01, 8.75116982822992661717e-01,
  8.78081248083697918361e-01, 8.81012194285784477898e-01,
  8.83909710213611976570e-01, 8.86773685920061893739e-01,
  8.89604012730709547974e-01, 8.92400583247947798426e-01,
  8.95163291355062340493e-01, 8.97892032220258040631e-01,
  9.00586702300637420571e-01, 9.03247199346128848418e-01,
  9.05873422403367101197e-01, 9.08465271819523634278e-01,
  9.11022649246088334074e-01, 9.13545457642600866599e-01,
  9.16033601280333509287e-01, 9.18486985745923023572e-01,
  9.20905517944953566634e-01, 9.23289106105489310039e-01,
  9.25637659781556210170e-01, 9.27951089856574595771e-01,
  9.30229308546740241148e-01, 9.32472229404355812399e-01,
  9.34679767321110577249e-01, 9.36851838531310598945e-01,
  9.38988360615056527614e-01, 9.41089252501371542614e-01,
  9.43154434471277447471e-01, 9.45183828160819583530e-01,
  9.47177356564040229259e-01, 9.49134944035901262360e-01,
  9.51056516295153531182e-01, 9.52942000427156488129e-01,
  9.54791324886644310332e-01, 9.56604419500440728008e-01,
  9.58381215470122227451e-01, 9.60121645374628074343e-01,
  9.61825643172819044757e-01, 9.63493144205983087502e-01,
  9.65124085200289028030e-01, 9.66718404269187425726e-01,
  9.68276040915758917649e-01, 9.69796936035009493615e-01,
  9.71281031916113812841e-01, 9.72728272244604785790e-01,
  9.74138602104510087365e-01, 9.75511967980436600634e-01,
  9.76848317759600681676e-01, 9.78147600733805577811e-01,
  9.79409767601365888190e-01, 9.80634770468977734481e-01,
  9.81822562853536862093e-01, 9.82973099683901785362e-01,
  9.84086337302604419186e-01, 9.85162233467506531781e-01,
  9.86200747353402573658e-01, 9.87201839553568993857e-01,
  9.88165472081259377291e-01, 9.89091608371145958323e-01,
  9.89980213280706955459e-01, 9.90831253091560282265e-01,
  9.91644695510742746336e-01, 9.92420509671935735518e-01,
  9.93158666136636170130e-01, 9.93859136895273720391e-01,
  9.94521895368273289861e-01, 9.95146916407064430210e-01,
  9.95734176295034467685e-01, 9.96283652748429449098e-01,
  9.96795324917199132564e-01, 9.97269173385788021413e-01,
  9.97705180173872885341e-01, 9.98103328737044104280e-01,
  9.98463603967433943609e-01, 9.98785992194289984347e-01,
  9.99070481184493153215e-01, 9.99317060143022906082e-01,
  9.99525719713365901065e-01, 9.99696451977871602956e-01,
  9.99829250458052709583e-01, 9.99924110114830622109e-01,
  9.99981027348726847492e-01, 1.00000000000000000000e+00,
};

#define SINTABLE_SIZE (sizeof(f_sintbl)/sizeof(f_sintbl[0]))
#define SINTABLE_DELTA ((M_PI / 2.) / (SINTABLE_SIZE - 1))
#define SINTABLE_REVDELTA ((SINTABLE_SIZE - 1) / (M_PI / 2.))
#endif

float my_sin(float theta)
{
  int quantization;
  int quarter;
  int phase;
  float rest;
  float next_value;
  float ret;

  float result_sin;

  quantization = (int)(theta * SINTABLE_REVDELTA);
  rest = (theta * SINTABLE_REVDELTA) - (float)quantization;

  quantization %= (SINTABLE_SIZE * 4);
  phase = quantization / SINTABLE_SIZE;

  quarter = quantization % SINTABLE_SIZE;

  if (phase & 0x01)
    {
      quarter = SINTABLE_SIZE - quarter - 1;
      ret = f_sintbl[quarter];
      if (quarter > 0)
        {
          ret = ret + (f_sintbl[quarter - 1] - ret) * rest;
        }
    }
  else
    {
      ret = f_sintbl[quarter];
      if (quarter < (SINTABLE_SIZE - 1))
        {
          ret = ret + (f_sintbl[quarter + 1] - ret) * rest;
        }
    }

  if (phase >= 2)
    {
      ret = -ret;
    }

  result_sin = sinf(theta);
#if 0
  printf("theta=%f, phase=%d, rest=%f, quantaization=%d, quarter=%d, sin()=%f, ref_sin()=%f", theta, phase, rest, quantization, quarter,
      ret, result_sin);
  if (fabsf(ret - result_sin) >= 0.005)
    {
      printf("  ERROR : %f\n", fabsf(ret - result_sin));
    }
  else
    {
      printf("\n");
    }
#else
  printf("%d,%f,%f\n", cnt++, ret, result_sin);
#endif

  return ret;
}

int main(void)
{
  float theta;

  printf("cnt, my_sin, mathlib\n");
  for (theta = 0; theta < (M_PI / 2.); theta = theta + (SINTABLE_DELTA / 10.))
    {
      my_sin(theta);
      // printf("%f, %f\n", sinf(theta), my_sin(theta));
    }

  for (theta = (M_PI / 2.); theta < M_PI; theta = theta + (SINTABLE_DELTA / 10.))
    {
      my_sin(theta);
    }

  for (theta = M_PI; theta < (M_PI * 3. / 2.); theta = theta + (SINTABLE_DELTA / 10.))
    {
      my_sin(theta);
    }

  for (theta = (M_PI * 3. / 2.); theta < (M_PI * 2.); theta = theta + (SINTABLE_DELTA / 10.))
    {
      my_sin(theta);
    }

  for (theta = (M_PI * 2.); theta < (M_PI * 10.); theta = theta + (SINTABLE_DELTA / 10.))
    {
      my_sin(theta);
    }

  return 0;
}
